<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Diagnostico Gliomi SNC v2.1 - Bibliografia Interattiva</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 8px;
        }
        
        .workflow-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            padding: 30px;
            background: #f8f9fa;
            min-height: 600px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        @media (max-width: 1200px) {
            .workflow-container { grid-template-columns: 1fr 1fr; }
        }
        
        @media (max-width: 768px) {
            .workflow-container { grid-template-columns: 1fr; }
        }
        
        .column {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .column.clinica { border-left: 4px solid #3498db; }
        .column.istologia { border-left: 4px solid #e74c3c; }
        .column.ihc { border-left: 4px solid #f39c12; }
        .column.molecolare { border-left: 4px solid #27ae60; }
        
        .column h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 16px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .col-icon { font-size: 20px; }
        
        .field-group {
            margin-bottom: 14px;
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            font-size: 12px;
            color: #555;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        select, input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background: white;
            color: #333;
            font-family: inherit;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .help-text {
            font-size: 11px;
            color: #999;
            margin-top: 3px;
            font-style: italic;
        }
        
        .warning-text {
            font-size: 11px;
            color: #d97706;
            background: #fef3c7;
            padding: 6px;
            border-radius: 3px;
            margin-top: 5px;
            border-left: 2px solid #f59e0b;
        }
        
        .success-text {
            font-size: 11px;
            color: #059669;
            background: #d1fae5;
            padding: 6px;
            border-radius: 3px;
            margin-top: 5px;
            border-left: 2px solid #10b981;
        }
        
        .diagnosis-section {
            padding: 30px;
            background: white;
        }
        
        .diagnosis-section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .diagnosis-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .diagnosis-box h3 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .diagnosis-text {
            color: #333;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            border-left: 3px solid #f59e0b;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
            border-left: 3px solid #10b981;
        }
        
        .alert-info {
            background: #cfe2ff;
            border: 1px solid #0d6efd;
            color: #084298;
            border-left: 3px solid #0d6efd;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-reset {
            background: #ecf0f1;
            color: #333;
            flex: 1;
            min-width: 100px;
        }
        
        .btn-reset:hover {
            background: #d5dbdb;
        }
        
        .btn-export {
            background: #27ae60;
            color: white;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-export:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.4);
        }
        
        .case-loader {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .case-loader label {
            font-weight: 600;
            font-size: 12px;
            margin: 0;
        }
        
        .case-loader select {
            flex: 1;
            min-width: 200px;
        }
        
        .case-loader button {
            padding: 8px 16px;
            font-size: 12px;
            background: #667eea;
            color: white;
        }
        
        .confidence-bar {
            width: 100%;
            height: 40px;
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #84cc16 75%, #22c55e 100%);
            border-radius: 4px;
            position: relative;
            margin: 10px 0;
        }
        
        .confidence-marker {
            position: absolute;
            top: 0;
            height: 100%;
            width: 3px;
            background: #000;
            border: 1px solid white;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
        }
        
        .scoring-container {
            background: linear-gradient(135deg, #f0f4ff 0%, #f9f5ff 100%);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .scoring-row {
            margin-bottom: 15px;
        }
        
        .scoring-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 13px;
        }
        
        .scoring-label-name {
            color: #333;
        }
        
        .scoring-label-percent {
            color: #667eea;
            font-size: 14px;
        }
        
        .biblio-section {
            padding: 30px;
            background: #f0f4ff;
            border-top: 2px solid #667eea;
        }
        
        .biblio-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        /* BIBLIOGRAFIA INTERATTIVA - NEW STYLES */
        .biblio-category {
            margin-bottom: 25px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .biblio-category.has-relevant {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .biblio-category-header {
            background: #f9fafb;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }
        
        .biblio-category-header:hover {
            background: #f3f4f6;
        }
        
        .biblio-category-title {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .biblio-category-toggle {
            font-size: 18px;
            color: #9ca3af;
            transition: transform 0.3s ease;
        }
        
        .biblio-category.expanded .biblio-category-toggle {
            transform: rotate(180deg);
        }
        
        .biblio-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }
        
        .biblio-category.expanded .biblio-category-content {
            max-height: 2000px;
        }
        
        .biblio-reference {
            padding: 15px 20px;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .biblio-reference:last-child {
            border-bottom: none;
        }
        
        .biblio-reference.relevant {
            background: linear-gradient(90deg, #fef3c7 0%, #fef3c7 5px, #fffbeb 5px);
            border-left: 5px solid #f59e0b;
            animation: highlightPulse 2s ease-in-out;
        }
        
        @keyframes highlightPulse {
            0%, 100% { background: white; }
            50% { background: linear-gradient(90deg, #fef3c7 0%, #fef3c7 5px, #fffbeb 5px); }
        }
        
        .biblio-reference-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 15px;
            margin-bottom: 8px;
        }
        
        .biblio-reference-authors {
            font-weight: 600;
            font-size: 13px;
            color: #1f2937;
            flex: 1;
        }
        
        .biblio-reference-year {
            background: #e5e7eb;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #6b7280;
            flex-shrink: 0;
        }
        
        .biblio-reference-title {
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .biblio-reference-journal {
            font-size: 11px;
            color: #9ca3af;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .biblio-reference-abstract {
            background: #f9fafb;
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 10px;
            display: none;
        }
        
        .biblio-reference.show-abstract .biblio-reference-abstract {
            display: block;
        }
        
        .biblio-reference-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .biblio-doi-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .biblio-doi-link:hover {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .biblio-pmid-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: #10b981;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .biblio-pmid-link:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .biblio-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .biblio-tag {
            padding: 3px 8px;
            background: #e0e7ff;
            color: #3730a3;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .biblio-relevance-badge {
            padding: 3px 8px;
            background: #f59e0b;
            color: white;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            animation: badgePulse 1.5s infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .abstract-toggle {
            background: none;
            border: none;
            color: #667eea;
            font-size: 11px;
            padding: 0;
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
            text-transform: none;
            letter-spacing: 0;
        }
        
        .abstract-toggle:hover {
            color: #5568d3;
        }
        
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        
        .print-only { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Tool Diagnostico Gliomi SNC v2.1</h1>
            <p>Workflow integrato: Clinica ‚Üí Istologia ‚Üí IHC ‚Üí Molecolare ‚Üí Diagnosi WHO CNS5</p>
            <p style="color: #e8f4f8; font-size: 12px; margin-top: 12px;">‚úì Scoring Avanzato | ‚úì Bibliografia Interattiva | ‚úì Gennaio 2026 Simulato</p>
            <div class="version-badge">v2.1 - BIBLIOGRAFIA INTERATTIVA</div>
        </div>
        
        <div class="case-loader">
            <label for="case-select">Carica caso precaricato:</label>
            <select id="case-select">
                <option value="">-- Seleziona caso --</option>
                <option value="case1">Caso 1: Astrocitoma IDH-mutato Gr.3</option>
                <option value="case2">Caso 2: Oligodendroglioma IDH-mut 1p/19q-codel</option>
                <option value="case3">Caso 3: Glioblastoma IDH-wildtype Gr.4</option>
                <option value="case4">Caso 4: Glioma linea mediana pediatrico (H3K27M-altered)</option>
            </select>
            <button onclick="loadCase()">Carica</button>
        </div>
        
        <div class="workflow-container">
            <!-- COLONNA 1: CLINICA -->
            <div class="column clinica">
                <h3><span class="col-icon">üë§</span> CLINICA</h3>
                
                <div class="field-group">
                    <label for="age">Et√† (anni)</label>
                    <input type="number" id="age" placeholder="es. 45" min="0" max="100">
                </div>
                
                <div class="field-group">
                    <label for="location">Sede tumorale</label>
                    <select id="location">
                        <option value="">-- Seleziona --</option>
                        <option value="emisfero">Emisfero cerebrale</option>
                        <option value="linea-mediana">Linea mediana/ponte</option>
                        <option value="midline">Midline (tectum, III ventricolo)</option>
                        <option value="cervelletto">Cervelletto/fossa posteriore</option>
                        <option value="spinale">Midollo spinale</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="imaging">Imaging (MRI pattern)</label>
                    <select id="imaging">
                        <option value="">-- Seleziona --</option>
                        <option value="enhancement">Enhancement omogeneo</option>
                        <option value="heterogeneous">Enhancement eterogeneo</option>
                        <option value="ring">Impronta ad anello + necrosi</option>
                        <option value="diffuse">Infiltrante diffuso</option>
                        <option value="midline-diffuse">Diffuso linea mediana</option>
                    </select>
                </div>
            </div>
            
            <!-- COLONNA 2: ISTOLOGIA -->
            <div class="column istologia">
                <h3><span class="col-icon">üî¨</span> ISTOLOGIA</h3>
                
                <div class="field-group">
                    <label for="cellularity">Cellularit√†</label>
                    <select id="cellularity">
                        <option value="">-- Seleziona --</option>
                        <option value="low">Bassa</option>
                        <option value="moderate">Moderata</option>
                        <option value="high">Alta</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="atypia">Atipia Nucleare</label>
                    <select id="atypia">
                        <option value="">-- Seleziona --</option>
                        <option value="scarse">Scarse</option>
                        <option value="moderate">Moderate</option>
                        <option value="numerose">Numerose</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="mitosis">Mitosi per 10 HPF</label>
                    <input type="number" id="mitosis" placeholder="es. 5" min="0" max="100">
                    <span class="help-text">Gr.2: &lt;4 | Gr.3: 4-9 | Gr.4: ‚â•10</span>
                </div>
                
                <div class="field-group">
                    <label>Architettura/Pattern</label>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="hist-necrosis">
                            <label for="hist-necrosis" style="margin: 0; font-weight: normal; text-transform: none; font-size: 13px; cursor: pointer;">Necrosi</label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="hist-microvascular">
                            <label for="hist-microvascular" style="margin: 0; font-weight: normal; text-transform: none; font-size: 13px; cursor: pointer;">Proliferazione microvascolare</label>
                        </div>
                    </div>
                </div>
                
                <div class="field-group">
                    <label for="celltype">Pattern cellulare</label>
                    <select id="celltype">
                        <option value="">-- Seleziona --</option>
                        <option value="astrocytic">Astrocitario</option>
                        <option value="oligodendroglial">Oligodendroglia</option>
                        <option value="mixed">Misto</option>
                        <option value="glioblastic">Glioblastoma (pleomorfo)</option>
                    </select>
                </div>
            </div>
            
            <!-- COLONNA 3: IHC -->
            <div class="column ihc">
                <h3><span class="col-icon">üîµ</span> IHC</h3>
                
                <div class="field-group">
                    <label for="gfap">GFAP</label>
                    <select id="gfap">
                        <option value="">-- Seleziona --</option>
                        <option value="positive">Positivo</option>
                        <option value="negative">Negativo</option>
                        <option value="partial">Positivo focale/debole</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="s100">S100</label>
                    <select id="s100">
                        <option value="">-- Seleziona --</option>
                        <option value="positive">Positivo</option>
                        <option value="negative">Negativo</option>
                        <option value="partial">Positivo focale/debole</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="idh-ihc">IDH1 R132H (IHC)</label>
                    <select id="idh-ihc">
                        <option value="">-- Seleziona --</option>
                        <option value="positive">Positivo</option>
                        <option value="negative">Negativo</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="atrx">ATRX (IHC)</label>
                    <select id="atrx">
                        <option value="">-- Seleziona --</option>
                        <option value="retained">Conservato (wild-type)</option>
                        <option value="lost">Perso (mutato)</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="p53">p53 (%)</label>
                    <input type="number" id="p53" placeholder="es. 25" min="0" max="100">
                    <span class="help-text">Range: 0-100% | Soglia: &gt;10% = positivo (accumulo proteico)</span>
                    <span class="warning-text">‚ö† p53 IHC>10% suggerisce mutazione TP53 | Confermare con NGS</span>
                </div>
                
                <div class="field-group">
                    <label for="olig2">OLIG2</label>
                    <select id="olig2">
                        <option value="">-- Seleziona --</option>
                        <option value="positive">Positivo</option>
                        <option value="negative">Negativo</option>
                        <option value="partial">Positivo focale/debole</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="h3k27me3">H3K27me3 (IHC)</label>
                    <select id="h3k27me3">
                        <option value="">-- Seleziona --</option>
                        <option value="retained">Conservato</option>
                        <option value="lost">Perso (H3K27-altered)</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                    <span class="help-text">H3K27me3 loss = forte sospetto DMG</span>
                </div>
                
                <div class="field-group">
                    <label for="ki67">Ki-67 (%)</label>
                    <input type="number" id="ki67" placeholder="es. 15" min="0" max="100">
                    <span class="help-text">Range: 0-100%</span>
                </div>
            </div>
            
            <!-- COLONNA 4: MOLECOLARE -->
            <div class="column molecolare">
                <h3><span class="col-icon">üß¨</span> MOLECOLARE (NGS)</h3>
                <span style="font-size: 11px; color: #27ae60; font-weight: 600; display: block; margin-bottom: 15px;">‚úì Gennaio 2026: Pannello COMPLETO ABILITATO</span>
                
                <div class="field-group">
                    <label for="idh-ngs">IDH1/2 (NGS)</label>
                    <select id="idh-ngs">
                        <option value="">-- Seleziona --</option>
                        <option value="mut-r132h">Mutato: IDH1 R132H</option>
                        <option value="mut-idh2">Mutato: IDH2</option>
                        <option value="mut-other">Mutato: altra mutazione</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="tp53-ngs">TP53 (NGS)</label>
                    <select id="tp53-ngs">
                        <option value="">-- Seleziona --</option>
                        <option value="mutato">Mutato</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                    <span class="success-text">‚úì ORA DISPONIBILE (gennaio 2026)</span>
                    <span class="help-text">TP53 mutato = marker di aggressivit√†, predice Grade 3-4 anche se morfologia lieve | Concordanza con p53 IHC>10%</span>
                </div>
                
                <div class="field-group">
                    <label for="1p19q">1p/19q (NGS/FISH)</label>
                    <select id="1p19q">
                        <option value="">-- Seleziona --</option>
                        <option value="codeleted">Codel: 1p/19q codeleted</option>
                        <option value="not-codeleted">Non codel: conservato</option>
                        <option value="partial">Parziale/ambiguo</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                    <span class="success-text">‚úì ORA DISPONIBILE (gennaio 2026)</span>
                </div>
                
                <div class="field-group">
                    <label for="tert">TERT Promoter (NGS)</label>
                    <select id="tert">
                        <option value="">-- Seleziona --</option>
                        <option value="mutato">Mutato (C228T o C250T)</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                    <span class="success-text">‚úì ORA DISPONIBILE (gennaio 2026)</span>
                </div>
                
                <div class="field-group">
                    <label for="egfr">EGFR (NGS)</label>
                    <select id="egfr">
                        <option value="">-- Seleziona --</option>
                        <option value="amplified">Amplificato</option>
                        <option value="vIII">Mutazione vIII</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="h3f3a">H3F3A (NGS)</label>
                    <select id="h3f3a">
                        <option value="">-- Seleziona --</option>
                        <option value="k27m">K27M</option>
                        <option value="g34r">G34R</option>
                        <option value="g34w">G34W</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="cdkn2a">CDKN2A/B (NGS)</label>
                    <select id="cdkn2a">
                        <option value="">-- Seleziona --</option>
                        <option value="homozygous-del">Delezione omozigote (Grade 4 auto)</option>
                        <option value="heterozygous-del">Delezione eterozigote</option>
                        <option value="wildtype">Wild-type</option>
                        <option value="not-done">Non eseguito</option>
                    </select>
                    <span class="warning-text">‚ö† Homozygous deletion = Grade 4 automatico (WHO CNS5)</span>
                </div>
            </div>
        </div>
        
        <div style="padding: 30px; background: #fafafa; border-bottom: 2px solid #e0e0e0;">
            <h3 style="margin-bottom: 15px; color: #333;">üî¨ MARCATORI PREDITTIVI (test opzionale)</h3>
            <div style="background: white; border: 2px solid #ddd; border-left: 4px solid #9b59b6; border-radius: 8px; padding: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label for="mgmt" style="font-weight: 600; font-size: 12px; color: #555; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 0.5px;">MGMT Promoter Metilazione</label>
                        <select id="mgmt" style="padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; background: white; color: #333; font-family: inherit; width: 100%;">
                            <option value="">-- Seleziona --</option>
                            <option value="not-done">Non eseguito</option>
                            <option value="methylated">Metilato (promoter metilato)</option>
                            <option value="unmethylated">Non metilato (promoter non metilato)</option>
                        </select>
                        <span style="font-size: 11px; color: #999; margin-top: 5px; display: block; font-style: italic;">Predittivo di risposta a temozolomide (GBM)</span>
                    </div>
                    <div>
                        <label for="o6mg" style="font-weight: 600; font-size: 12px; color: #555; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 0.5px;">O6-Metilguanina-DNA Metiltransferasi</label>
                        <select id="o6mg" style="padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; background: white; color: #333; font-family: inherit; width: 100%;">
                            <option value="">-- Seleziona --</option>
                            <option value="not-done">Non eseguito</option>
                            <option value="high">Alta espressione (predittore sfavorevole)</option>
                            <option value="low">Bassa espressione (predittore favorevole)</option>
                        </select>
                        <span style="font-size: 11px; color: #999; margin-top: 5px; display: block; font-style: italic;">O6-methylguanine-DNA methyltransferase - Predittore di chemoresistenza</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="diagnosis-section">
            <h2>üìã Diagnosi WHO CNS5 v2.1 & Scoring Report</h2>
            
            <div class="button-group">
                <button class="btn-generate" onclick="generateDiagnosis()">Genera Diagnosi & Scoring</button>
                <button class="btn-reset" onclick="resetForm()">Reset</button>
                <button class="btn-export" onclick="exportPDF()">üì• Esporta PDF</button>
            </div>
            
            <div id="report-container"></div>
        </div>
        
        <div class="biblio-section">
            <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                üìö Riferimenti Bibliografici - WHO CNS5 2021
                <span id="relevance-badge" style="display: none; background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;"></span>
            </h3>
            
            <div style="background: #e0e7ff; border-left: 4px solid #667eea; padding: 12px; border-radius: 4px; margin-bottom: 20px; font-size: 12px;">
                <strong>üí° Bibliografia Interattiva:</strong> Dopo aver generato una diagnosi, i riferimenti pertinenti verranno evidenziati automaticamente. Click sui DOI per accesso diretto alle pubblicazioni.
            </div>
            
            <div id="biblio-container"></div>
        </div>
    </div>
    
    <script>
        // DATABASE BIBLIOGRAFIA CON METADATA COMPLETI
        const bibliography = {
            "who_classification": {
                title: "Classificazione WHO & Grading",
                icon: "üìñ",
                references: [
                    {
                        id: "louis2021",
                        authors: "Louis DN, Perry A, Wesseling P, et al.",
                        year: 2021,
                        title: "The 2021 WHO Classification of Tumors of the Central Nervous System: a summary",
                        journal: "Neuro Oncol. 2021;23(8):1231-1251",
                        doi: "10.1093/neuonc/noab106",
                        pmid: "34185076",
                        abstract: "Guida ufficiale WHO CNS5 2021 con integrazione molecolare obbligatoria. Introduce grading dinamico basato su CDKN2A/B homozygous deletion.",
                        tags: ["WHO", "GRADING", "IDH", "1P/19Q", "CDKN2A"]
                    },
                    {
                        id: "brat2020",
                        authors: "Brat DJ, Aldape K, Colman H, et al.",
                        year: 2020,
                        title: "cIMPACT-NOW update 6: new entity and diagnostic principle recommendations of the cIMPACT-Utrecht meeting on future CNS tumor classification and grading",
                        journal: "Brain Pathol. 2020;30(4):844-856",
                        doi: "10.1111/bpa.12832",
                        pmid: "32307792",
                        abstract: "Raccomandazioni cIMPACT-NOW che hanno anticipato WHO CNS5: grading integrato morfologia-molecolare, ruolo CDKN2A/B deletion.",
                        tags: ["GRADING", "CDKN2A", "MOLECULAR"]
                    },
                    {
                        id: "louis2016",
                        authors: "Louis DN, Perry A, Reifenberger G, et al.",
                        year: 2016,
                        title: "The 2016 World Health Organization Classification of Tumors of the Central Nervous System: a summary",
                        journal: "Acta Neuropathol. 2016;131(6):803-820",
                        doi: "10.1007/s00401-016-1545-1",
                        pmid: "27157931",
                        abstract: "WHO CNS4 2016 - prima integrazione diagnostica IDH/1p/19q. Base storica per CNS5.",
                        tags: ["WHO", "IDH", "HISTORICAL"]
                    }
                ]
            },
            "idh_astrocytoma": {
                title: "Astrocytoma IDH-mutated",
                icon: "üß¨",
                references: [
                    {
                        id: "baumgarten2020",
                        authors: "Baumgarten P, Harter PN, T√∂njes M, et al.",
                        year: 2020,
                        title: "Loss of FUBP1 expression in gliomas predicts FUBP1 mutation and is associated with oligodendroglial differentiation, IDH1 mutation and 1p/19q loss of heterozygosity",
                        journal: "Neuropathol Appl Neurobiol. 2014;40(2):205-216",
                        doi: "10.1111/nan.12088",
                        pmid: "24102453",
                        abstract: "Correlazione ATRX loss con fenotipo astrocitario IDH-mutato. ATRX retained suggerisce oligodendroglioma.",
                        tags: ["IDH", "ATRX", "ASTROCYTOMA"]
                    },
                    {
                        id: "reuss2015",
                        authors: "Reuss DE, Sahm F, Schrimpf D, et al.",
                        year: 2015,
                        title: "ATRX and IDH1-R132H immunohistochemistry with subsequent copy number analysis and IDH sequencing as a basis for an 'integrated' diagnostic approach for adult astrocytoma, oligodendroglioma and glioblastoma",
                        journal: "Acta Neuropathol. 2015;129(1):133-146",
                        doi: "10.1007/s00401-014-1370-3",
                        pmid: "25427834",
                        abstract: "Workflow diagnostico integrato IHC‚Üímolecolare per gliomi adulti. ATRX loss + IDH mutation = astrocytoma.",
                        tags: ["IDH", "ATRX", "WORKFLOW", "ASTROCYTOMA"]
                    },
                    {
                        id: "watanabe2009",
                        authors: "Watanabe T, Nobusawa S, Kleihues P, Ohgaki H",
                        year: 2009,
                        title: "IDH1 mutations are early events in the development of astrocytomas and oligodendrogliomas",
                        journal: "Am J Pathol. 2009;174(4):1149-1153",
                        doi: "10.2353/ajpath.2009.080958",
                        pmid: "19246647",
                        abstract: "IDH mutation √® evento early in gliomi diffusi. Presente in Grade 2-4 ma ASSENTE in glioblastoma primario.",
                        tags: ["IDH", "PATHOGENESIS", "ASTROCYTOMA"]
                    }
                ]
            },
            "oligodendroglioma": {
                title: "Oligodendroglioma 1p/19q-codeleted",
                icon: "üîµ",
                references: [
                    {
                        id: "cairncross2013",
                        authors: "Cairncross JG, Wang M, Jenkins RB, et al.",
                        year: 2013,
                        title: "Benefit from procarbazine, lomustine, and vincristine in oligodendroglial tumors is associated with mutation of IDH",
                        journal: "J Clin Oncol. 2014;32(8):783-790",
                        doi: "10.1200/JCO.2013.49.3726",
                        pmid: "24516018",
                        abstract: "Trial clinico dimostra prognosi favorevole oligodendroglioma IDH-mut 1p/19q-codel. Risposta eccellente a chemioterapia PCV.",
                        tags: ["OLIGODENDROGLIOMA", "1P/19Q", "PROGNOSIS", "THERAPY"]
                    },
                    {
                        id: "jenkins2006",
                        authors: "Jenkins RB, Blair H, Ballman KV, et al.",
                        year: 2006,
                        title: "A t(1;19)(q10;p10) mediates the combined deletions of 1p and 19q and predicts a better prognosis of patients with oligodendroglioma",
                        journal: "Cancer Res. 2006;66(20):9852-9861",
                        doi: "10.1158/0008-5472.CAN-06-1796",
                        pmid: "17047046",
                        abstract: "Meccanismo genetico 1p/19q codeletion: traslocazione bilanciata t(1;19). Predittore prognostico favorevole.",
                        tags: ["OLIGODENDROGLIOMA", "1P/19Q", "GENETICS"]
                    },
                    {
                        id: "van2012",
                        authors: "van den Bent MJ, Brandes AA, Taphoorn MJ, et al.",
                        year: 2013,
                        title: "Adjuvant procarbazine, lomustine, and vincristine chemotherapy in newly diagnosed anaplastic oligodendroglioma: long-term follow-up of EORTC brain tumor group study 26951",
                        journal: "J Clin Oncol. 2013;31(3):344-350",
                        doi: "10.1200/JCO.2012.43.2229",
                        pmid: "23071237",
                        abstract: "EORTC 26951: beneficio long-term chemioterapia in oligodendroglioma anaplastico 1p/19q-codel.",
                        tags: ["OLIGODENDROGLIOMA", "1P/19Q", "THERAPY", "CLINICAL-TRIAL"]
                    }
                ]
            },
            "glioblastoma": {
                title: "Glioblastoma IDH-wildtype",
                icon: "üî¥",
                references: [
                    {
                        id: "brennan2013",
                        authors: "Brennan CW, Verhaak RG, McKenna A, et al. (TCGA)",
                        year: 2013,
                        title: "The somatic genomic landscape of glioblastoma",
                        journal: "Cell. 2013;155(2):462-477",
                        doi: "10.1016/j.cell.2013.09.034",
                        pmid: "24120142",
                        abstract: "TCGA GBM: alterazioni genomiche ricorrenti (EGFR amp, PTEN loss, TP53, TERT promoter). Subtypes molecolari Proneural/Classical/Mesenchymal.",
                        tags: ["GLIOBLASTOMA", "EGFR", "TP53", "TERT", "TCGA"]
                    },
                    {
                        id: "ohgaki2013",
                        authors: "Ohgaki H, Kleihues P",
                        year: 2013,
                        title: "The definition of primary and secondary glioblastoma",
                        journal: "Clin Cancer Res. 2013;19(4):764-772",
                        doi: "10.1158/1078-0432.CCR-12-3002",
                        pmid: "23209033",
                        abstract: "Definizione GBM primario (de novo, IDH-wt, EGFR amp) vs secondario (progressione da LGG, IDH-mut, TP53 mut).",
                        tags: ["GLIOBLASTOMA", "IDH", "TP53", "EGFR"]
                    },
                    {
                        id: "killela2013",
                        authors: "Killela PJ, Reitman ZJ, Jiao Y, et al.",
                        year: 2013,
                        title: "TERT promoter mutations occur frequently in gliomas and a subset of tumors derived from cells with low rates of self-renewal",
                        journal: "Proc Natl Acad Sci USA. 2013;110(15):6021-6026",
                        doi: "10.1073/pnas.1303607110",
                        pmid: "23530248",
                        abstract: "TERT promoter mutation (C228T, C250T) in 83% GBM primari. Correlata con prognosi sfavorevole e telomerase reactivation.",
                        tags: ["GLIOBLASTOMA", "TERT", "PROGNOSIS"]
                    }
                ]
            },
            "h3_dmg": {
                title: "Diffuse Midline Glioma H3-altered",
                icon: "‚ö†Ô∏è",
                references: [
                    {
                        id: "sturm2012",
                        authors: "Sturm D, Witt H, Hovestadt V, et al.",
                        year: 2012,
                        title: "Hotspot mutations in H3F3A and IDH1 define distinct epigenetic and biological subgroups of glioblastoma",
                        journal: "Cancer Cell. 2012;22(4):425-437",
                        doi: "10.1016/j.ccr.2012.08.024",
                        pmid: "23079654",
                        abstract: "H3F3A K27M mutation definisce subgruppo pediatrico pontino (DIPG) con prognosi infausta. Alterazione epigenetica globale.",
                        tags: ["DMG", "H3K27M", "PEDIATRIC", "PROGNOSIS"]
                    },
                    {
                        id: "schwartzentruber2012",
                        authors: "Schwartzentruber J, Korshunov A, Liu XY, et al.",
                        year: 2012,
                        title: "Driver mutations in histone H3.3 and chromatin remodelling genes in paediatric glioblastoma",
                        journal: "Nature. 2012;482(7384):226-231",
                        doi: "10.1038/nature10833",
                        pmid: "22286061",
                        abstract: "Discovery H3F3A K27M e G34R/V mutations in pediatric HGG. K27M ‚Üí midline, G34 ‚Üí hemispheric.",
                        tags: ["DMG", "H3K27M", "H3G34", "PEDIATRIC"]
                    },
                    {
                        id: "castel2015",
                        authors: "Castel D, Philippe C, Calmon R, et al.",
                        year: 2015,
                        title: "Histone H3F3A and HIST1H3B K27M mutations define two subgroups of diffuse intrinsic pontine gliomas with different prognosis and phenotypes",
                        journal: "Acta Neuropathol. 2015;130(6):815-827",
                        doi: "10.1007/s00401-015-1478-0",
                        pmid: "26399630",
                        abstract: "H3.3 K27M vs H3.1 K27M in DIPG: sottogruppi biologici distinti. H3.3 pi√π aggressivo.",
                        tags: ["DMG", "H3K27M", "DIPG", "PROGNOSIS"]
                    },
                    {
                        id: "louis2014",
                        authors: "Louis DN, Giannini C, Capper D, et al.",
                        year: 2018,
                        title: "cIMPACT-NOW update 2: diagnostic clarifications for diffuse midline glioma, H3 K27M-mutant",
                        journal: "Acta Neuropathol. 2018;135(4):639-642",
                        doi: "10.1007/s00401-018-1826-y",
                        pmid: "29497819",
                        abstract: "Raccomandazioni cIMPACT-NOW: DMG H3K27-altered sempre Grade 4, indipendentemente da morfologia. H3K27me3 IHC come surrogate marker.",
                        tags: ["DMG", "H3K27M", "GRADING", "IHC"]
                    }
                ]
            },
            "molecular_grading": {
                title: "NGS Panel & Grading Molecolare",
                icon: "üî¨",
                references: [
                    {
                        id: "suzuki2015",
                        authors: "Suzuki H, Aoki K, Chiba K, et al.",
                        year: 2015,
                        title: "Mutational landscape and clonal architecture in grade II and III gliomas",
                        journal: "Nat Genet. 2015;47(5):458-468",
                        doi: "10.1038/ng.3273",
                        pmid: "25848751",
                        abstract: "Landscape mutazionale LGG: IDH1/2, TP53, ATRX, CIC, FUBP1, NOTCH1. Clonal evolution da Grade 2‚Üí3‚Üí4.",
                        tags: ["NGS", "IDH", "TP53", "GRADING"]
                    },
                    {
                        id: "tcga2015",
                        authors: "Cancer Genome Atlas Research Network",
                        year: 2015,
                        title: "Comprehensive, Integrative Genomic Analysis of Diffuse Lower-Grade Gliomas",
                        journal: "N Engl J Med. 2015;372(26):2481-2498",
                        doi: "10.1056/NEJMoa1402121",
                        pmid: "26061751",
                        abstract: "TCGA LGG: 3 gruppi prognostici molecolari. IDH-mut/1p19q-codel (best), IDH-mut/non-codel (intermediate), IDH-wt (worst).",
                        tags: ["NGS", "IDH", "1P/19Q", "PROGNOSIS", "TCGA"]
                    },
                    {
                        id: "shirahata2009",
                        authors: "Shirahata M, Ono T, Stichel D, et al.",
                        year: 2018,
                        title: "Novel, improved grading system(s) for IDH-mutant astrocytic gliomas",
                        journal: "Acta Neuropathol. 2018;136(1):153-166",
                        doi: "10.1007/s00401-018-1849-4",
                        pmid: "29679143",
                        abstract: "Proposta grading molecolare per astrocytoma IDH-mut: CDKN2A/B deletion automaticamente Grade 4 (anticipazione WHO CNS5).",
                        tags: ["GRADING", "CDKN2A", "IDH", "ASTROCYTOMA"]
                    }
                ]
            },
            "mgmt_predictive": {
                title: "MGMT & Marcatori Predittivi",
                icon: "üíä",
                references: [
                    {
                        id: "hegi2005",
                        authors: "Hegi ME, Diserens AC, Gorlia T, et al.",
                        year: 2005,
                        title: "MGMT gene silencing and benefit from temozolomide in glioblastoma",
                        journal: "N Engl J Med. 2005;352(10):997-1003",
                        doi: "10.1056/NEJMoa043331",
                        pmid: "15758010",
                        abstract: "Studio landmark: MGMT promoter methylation predice risposta a temozolomide in GBM. Methylated = sopravvivenza mediana 21.7 mesi vs 12.7 unmethylated.",
                        tags: ["MGMT", "TEMOZOLOMIDE", "PROGNOSIS", "GLIOBLASTOMA"]
                    },
                    {
                        id: "stupp2009",
                        authors: "Stupp R, Hegi ME, Mason WP, et al.",
                        year: 2009,
                        title: "Effects of radiotherapy with concomitant and adjuvant temozolomide versus radiotherapy alone on survival in glioblastoma in a randomised phase III study: 5-year analysis of the EORTC-NCIC trial",
                        journal: "Lancet Oncol. 2009;10(5):459-466",
                        doi: "10.1016/S1470-2045(09)70025-7",
                        pmid: "19269895",
                        abstract: "EORTC-NCIC trial: Stupp protocol (RT+TMZ) diventa standard care GBM. MGMT methylation conferma valore predittivo long-term.",
                        tags: ["MGMT", "TEMOZOLOMIDE", "GLIOBLASTOMA", "CLINICAL-TRIAL"]
                    },
                    {
                        id: "wick2012",
                        authors: "Wick W, Meisner C, Hentschel B, et al.",
                        year: 2012,
                        title: "Prognostic or predictive value of MGMT promoter methylation in gliomas depends on IDH1 mutation",
                        journal: "Neurology. 2013;81(17):1515-1522",
                        doi: "10.1212/WNL.0b013e3182a95680",
                        pmid: "24068788",
                        abstract: "MGMT valore predittivo √® context-dependent: forte in IDH-wt GBM, meno rilevante in IDH-mut gliomas.",
                        tags: ["MGMT", "IDH", "PROGNOSIS"]
                    }
                ]
            },
            "tp53_cdkn2a": {
                title: "TP53 & CDKN2A/B (CNS5 Grading)",
                icon: "üß¨",
                references: [
                    {
                        id: "banan2020",
                        authors: "Banan R, Hartmann C, Martinkova E, et al.",
                        year: 2020,
                        title: "CDKN2A/B homozygous deletion is a strong adverse prognostic factor in IDH-mutant glioma",
                        journal: "Neuro Oncol. 2021;23(1):39-49",
                        doi: "10.1093/neuonc/noaa253",
                        pmid: "33141886",
                        abstract: "CDKN2A/B homozygous deletion = Grade 4 automatico WHO CNS5. Outcome simile a GBM anche se morfologia low-grade.",
                        tags: ["CDKN2A", "GRADING", "IDH", "PROGNOSIS"]
                    },
                    {
                        id: "shirahata2018",
                        authors: "Shirahata M, Ono T, Stichel D, et al.",
                        year: 2018,
                        title: "Novel, improved grading system(s) for IDH-mutant astrocytic gliomas",
                        journal: "Acta Neuropathol. 2018;136(1):153-166",
                        doi: "10.1007/s00401-018-1849-4",
                        pmid: "29679143",
                        abstract: "Proposal WHO CNS5 grading: CDKN2A/B hom del = automatic Grade 4, anche senza necrosi/MVP.",
                        tags: ["CDKN2A", "GRADING", "WHO"]
                    },
                    {
                        id: "brat2018",
                        authors: "Brat DJ, Aldape K, Colman H, et al.",
                        year: 2018,
                        title: "cIMPACT-NOW update 3: recommended diagnostic criteria for 'Diffuse astrocytic glioma, IDH-wildtype, with molecular features of glioblastoma, WHO grade IV'",
                        journal: "Acta Neuropathol. 2018;136(5):805-810",
                        doi: "10.1007/s00401-018-1913-0",
                        pmid: "30259105",
                        abstract: "Raccomandazione cIMPACT-NOW: glioma astrocitario IDH-wt con EGFR amp, +7/-10, TERT mut = Grade 4 'molecolare' anche senza features istologiche GBM.",
                        tags: ["GRADING", "IDH", "EGFR", "TERT"]
                    },
                    {
                        id: "kamoun2016",
                        authors: "Kamoun A, Idbaih A, Dehais C, et al.",
                        year: 2016,
                        title: "Integrated multi-omics analysis of oligodendroglial tumours identifies three subgroups of 1p/19q co-deleted gliomas",
                        journal: "Nat Commun. 2016;7:11263",
                        doi: "10.1038/ncomms11263",
                        pmid: "27098550",
                        abstract: "Sottogruppi molecolari oligodendroglioma 1p/19q-codel. TP53 mutation √® RARA in oligo (mutually exclusive con 1p/19q).",
                        tags: ["OLIGODENDROGLIOMA", "TP53", "1P/19Q"]
                    }
                ]
            }
        };
        
        // RENDERING BIBLIOGRAFIA INTERATTIVA
        function renderBibliography() {
            const container = document.getElementById('biblio-container');
            let html = '';
            
            for (const [categoryId, category] of Object.entries(bibliography)) {
                html += `
                    <div class="biblio-category" id="cat-${categoryId}">
                        <div class="biblio-category-header" onclick="toggleCategory('${categoryId}')">
                            <div class="biblio-category-title">
                                <span>${category.icon}</span>
                                <span>${category.title}</span>
                                <span style="background: #e5e7eb; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; color: #6b7280; margin-left: 8px;">${category.references.length} refs</span>
                            </div>
                            <span class="biblio-category-toggle">‚ñº</span>
                        </div>
                        <div class="biblio-category-content">
                `;
                
                for (const ref of category.references) {
                    html += `
                        <div class="biblio-reference" id="ref-${ref.id}">
                            <div class="biblio-reference-header">
                                <div class="biblio-reference-authors">${ref.authors}</div>
                                <div class="biblio-reference-year">${ref.year}</div>
                            </div>
                            <div class="biblio-reference-title">${ref.title}</div>
                            <div class="biblio-reference-journal">${ref.journal}</div>
                            <div class="biblio-reference-abstract" id="abstract-${ref.id}">
                                <strong>Takeaway:</strong> ${ref.abstract}
                            </div>
                            <div class="biblio-reference-actions">
                                <a href="https://doi.org/${ref.doi}" target="_blank" class="biblio-doi-link">
                                    üìÑ DOI: ${ref.doi}
                                </a>
                                ${ref.pmid ? `<a href="https://pubmed.ncbi.nlm.nih.gov/${ref.pmid}/" target="_blank" class="biblio-pmid-link">üî¨ PMID: ${ref.pmid}</a>` : ''}
                                <button class="abstract-toggle" onclick="toggleAbstract('${ref.id}')">Mostra Abstract</button>
                            </div>
                            <div class="biblio-tags">
                                ${ref.tags.map(tag => `<span class="biblio-tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function toggleCategory(categoryId) {
            const category = document.getElementById(`cat-${categoryId}`);
            category.classList.toggle('expanded');
        }
        
        function toggleAbstract(refId) {
            const reference = document.getElementById(`ref-${refId}`);
            const button = reference.querySelector('.abstract-toggle');
            
            if (reference.classList.contains('show-abstract')) {
                reference.classList.remove('show-abstract');
                button.textContent = 'Mostra Abstract';
            } else {
                reference.classList.add('show-abstract');
                button.textContent = 'Nascondi Abstract';
            }
        }
        
        // HIGHLIGHTING BIBLIOGRAFIA BASATO SU DIAGNOSI
        function highlightRelevantReferences(diagnosis, data) {
            // Reset all highlights
            document.querySelectorAll('.biblio-reference.relevant').forEach(el => {
                el.classList.remove('relevant');
                const badge = el.querySelector('.biblio-relevance-badge');
                if (badge) badge.remove();
            });
            
            document.querySelectorAll('.biblio-category.has-relevant').forEach(el => {
                el.classList.remove('has-relevant');
            });
            
            // Determine relevant tags based on diagnosis
            let relevantTags = new Set(['WHO', 'GRADING']); // Always relevant
            
            // IDH status
            if (data['idh-ngs'].includes('mutato') || data['idh-ihc'] === 'positive') {
                relevantTags.add('IDH');
            }
            
            // Entity-specific
            if (diagnosis.entity && diagnosis.entity.includes('Astrocytoma')) {
                relevantTags.add('ASTROCYTOMA');
                relevantTags.add('ATRX');
                if (data.atrx === 'lost') relevantTags.add('ATRX');
            }
            
            if (diagnosis.entity && diagnosis.entity.includes('Oligodendroglioma')) {
                relevantTags.add('OLIGODENDROGLIOMA');
                relevantTags.add('1P/19Q');
            }
            
            if (diagnosis.entity && diagnosis.entity.includes('Glioblastoma')) {
                relevantTags.add('GLIOBLASTOMA');
                relevantTags.add('EGFR');
                relevantTags.add('TERT');
                if (data.mgmt !== '' && data.mgmt !== 'not-done') {
                    relevantTags.add('MGMT');
                    relevantTags.add('TEMOZOLOMIDE');
                }
            }
            
            if (diagnosis.entity && diagnosis.entity.includes('Midline Glioma')) {
                relevantTags.add('DMG');
                relevantTags.add('H3K27M');
                relevantTags.add('PEDIATRIC');
            }
            
            // Molecular markers
            if (data['tp53-ngs'] === 'mutato' || data.p53 > 10) {
                relevantTags.add('TP53');
            }
            
            if (data.cdkn2a === 'homozygous-del') {
                relevantTags.add('CDKN2A');
            }
            
            if (data['1p19q'] === 'codeleted') {
                relevantTags.add('1P/19Q');
            }
            
            if (data.tert === 'mutato') {
                relevantTags.add('TERT');
            }
            
            if (data.egfr === 'amplified' || data.egfr === 'vIII') {
                relevantTags.add('EGFR');
            }
            
            // Highlight matching references
            let relevantCount = 0;
            
            for (const [categoryId, category] of Object.entries(bibliography)) {
                let categoryHasRelevant = false;
                
                for (const ref of category.references) {
                    const hasMatch = ref.tags.some(tag => relevantTags.has(tag));
                    
                    if (hasMatch) {
                        const refElement = document.getElementById(`ref-${ref.id}`);
                        refElement.classList.add('relevant');
                        
                        // Add relevance badge
                        const actionsDiv = refElement.querySelector('.biblio-reference-actions');
                        const badge = document.createElement('span');
                        badge.className = 'biblio-relevance-badge';
                        badge.textContent = '‚úì Rilevante';
                        actionsDiv.insertBefore(badge, actionsDiv.firstChild);
                        
                        relevantCount++;
                        categoryHasRelevant = true;
                    }
                }
                
                if (categoryHasRelevant) {
                    document.getElementById(`cat-${categoryId}`).classList.add('has-relevant');
                }
            }
            
            // Update relevance badge in header
            const badge = document.getElementById('relevance-badge');
            if (relevantCount > 0) {
                badge.textContent = `${relevantCount} riferimenti pertinenti evidenziati`;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Initialize bibliography on page load
        document.addEventListener('DOMContentLoaded', function() {
            renderBibliography();
        });
        
        // CASI PRECARICATI
        const cases = {
            case1: {
                age: 45, location: 'emisfero', imaging: 'heterogeneous',
                cellularity: 'high', atypia: 'moderate', mitosis: 6, celltype: 'astrocytic',
                gfap: 'positive', s100: 'positive', 'idh-ihc': 'positive',
                atrx: 'lost', p53: 20, olig2: 'negative', h3k27me3: 'retained',
                ki67: 20, 'idh-ngs': 'mut-r132h', 'tp53-ngs': 'mutato',
                '1p19q': 'not-codeleted', tert: 'not-done', egfr: 'wildtype',
                h3f3a: 'wildtype', cdkn2a: 'wildtype', mgmt: 'not-done', o6mg: 'not-done'
            },
            case2: {
                age: 52, location: 'emisfero', imaging: 'enhancement',
                cellularity: 'moderate', atypia: 'scarse', mitosis: 3, celltype: 'oligodendroglial',
                gfap: 'partial', s100: 'positive', 'idh-ihc': 'positive',
                atrx: 'retained', p53: 8, olig2: 'positive', h3k27me3: 'retained',
                ki67: 8, 'idh-ngs': 'mut-r132h', 'tp53-ngs': 'wildtype',
                '1p19q': 'codeleted', tert: 'wildtype', egfr: 'wildtype',
                h3f3a: 'wildtype', cdkn2a: 'wildtype', mgmt: 'not-done', o6mg: 'not-done'
            },
            case3: {
                age: 62, location: 'emisfero', imaging: 'ring',
                cellularity: 'high', atypia: 'numerose', mitosis: 15, celltype: 'glioblastic',
                gfap: 'partial', s100: 'negative', 'idh-ihc': 'negative',
                atrx: 'retained', p53: 70, olig2: 'negative', h3k27me3: 'retained',
                ki67: 45, 'idh-ngs': 'wildtype', 'tp53-ngs': 'mutato',
                '1p19q': 'not-codeleted', tert: 'mutato', egfr: 'amplified',
                h3f3a: 'wildtype', cdkn2a: 'wildtype', mgmt: 'methylated', o6mg: 'low'
            },
            case4: {
                age: 8, location: 'linea-mediana', imaging: 'midline-diffuse',
                cellularity: 'high', atypia: 'numerose', mitosis: 12, celltype: 'glioblastic',
                gfap: 'partial', s100: 'negative', 'idh-ihc': 'negative',
                atrx: 'retained', p53: 50, olig2: 'negative', h3k27me3: 'lost',
                ki67: 50, 'idh-ngs': 'wildtype', 'tp53-ngs': 'mutato',
                '1p19q': 'not-codeleted', tert: 'wildtype', egfr: 'wildtype',
                h3f3a: 'k27m', cdkn2a: 'homozygous-del', mgmt: 'unmethylated', o6mg: 'not-done'
            }
        };
        
        function loadCase() {
            const caseId = document.getElementById('case-select').value;
            if (!caseId || !cases[caseId]) return;
            
            const caseData = cases[caseId];
            for (const [key, value] of Object.entries(caseData)) {
                const el = document.getElementById(key);
                if (el) el.value = value;
            }
        }
        
        function resetForm() {
            document.querySelectorAll('input, select').forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else if (!el.disabled) el.value = '';
            });
            document.getElementById('report-container').innerHTML = '';
            document.getElementById('case-select').value = '';
            
            // Reset bibliography highlights
            document.querySelectorAll('.biblio-reference.relevant').forEach(el => {
                el.classList.remove('relevant');
                const badge = el.querySelector('.biblio-relevance-badge');
                if (badge) badge.remove();
            });
            
            document.querySelectorAll('.biblio-category.has-relevant').forEach(el => {
                el.classList.remove('has-relevant');
            });
            
            document.getElementById('relevance-badge').style.display = 'none';
        }
        
        function generateDiagnosis() {
            const data = {
                age: parseInt(document.getElementById('age').value) || 0,
                location: document.getElementById('location').value,
                cellularity: document.getElementById('cellularity').value,
                atypia: document.getElementById('atypia').value,
                mitosis: parseInt(document.getElementById('mitosis').value) || 0,
                celltype: document.getElementById('celltype').value,
                gfap: document.getElementById('gfap').value,
                s100: document.getElementById('s100').value,
                'idh-ihc': document.getElementById('idh-ihc').value,
                atrx: document.getElementById('atrx').value,
                p53: parseInt(document.getElementById('p53').value) || 0,
                olig2: document.getElementById('olig2').value,
                h3k27me3: document.getElementById('h3k27me3').value,
                ki67: parseInt(document.getElementById('ki67').value) || 0,
                'idh-ngs': document.getElementById('idh-ngs').value,
                'tp53-ngs': document.getElementById('tp53-ngs').value,
                '1p19q': document.getElementById('1p19q').value,
                tert: document.getElementById('tert').value,
                egfr: document.getElementById('egfr').value,
                h3f3a: document.getElementById('h3f3a').value,
                cdkn2a: document.getElementById('cdkn2a').value,
                mgmt: document.getElementById('mgmt').value,
                o6mg: document.getElementById('o6mg').value,
                histFeatures: {
                    necrosis: document.getElementById('hist-necrosis').checked,
                    microvascular: document.getElementById('hist-microvascular').checked
                }
            };
            
            const diagnosis = computeDiagnosis(data);
            displayDiagnosis(diagnosis, data);
            
            // Highlight relevant bibliography
            highlightRelevantReferences(diagnosis, data);
            
            // Scroll to bibliography
            setTimeout(() => {
                document.querySelector('.biblio-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 500);
        }
        
        function computeDiagnosis(data) {
            let alerts = [];
            let diagnosis = {};
            let scores = { astrocytoma: 0, oligodendroglioma: 0, glioblastoma: 0, dmg: 0 };
            
            // CHECK: CDKN2A/B Homozygous Deletion = AUTOMATIC GRADE 4
            if (data.cdkn2a === 'homozygous-del') {
                alerts.push({type: 'warning', msg: 'üö® CDKN2A/B homozygous deletion PRESENTE: WHO Grade 4 AUTOMATICO'});
                diagnosis.grade = 'WHO Grade 4';
                scores.glioblastoma += 100;
            }
            
            // CHECK: H3K27me3 LOSS o H3F3A K27M = DIFFUSE MIDLINE GLIOMA
            if (data.h3k27me3 === 'lost' || data.h3f3a === 'k27m') {
                alerts.push({type: 'warning', msg: 'üö® H3K27me3 loss o H3F3A K27M PRESENTE: Diffuse Midline Glioma'});
                diagnosis.grade = 'WHO Grade 4';
                diagnosis.entity = 'Glioma diffuso linea mediana, H3K27-altered';
                scores.dmg += 150;
            }
            
            // IDH STATUS - Priorit√† NGS
            let idhStatus = data['idh-ngs'];
            let idhFromIHC = false;
            
            if (!idhStatus || idhStatus === '' || idhStatus === 'not-done') {
                if (data['idh-ihc'] === 'positive') {
                    idhStatus = 'mutato-ihc';
                    idhFromIHC = true;
                } else if (data['idh-ihc'] === 'negative') {
                    idhStatus = 'wildtype-ihc';
                    idhFromIHC = true;
                } else {
                    alerts.push({type: 'warning', msg: 'üïê DIAGNOSI PROVVISORIA - IDH status non determinato'});
                    return { entity: 'Glioma (tipo indeterminato)', grade: 'Indeterminato', confidence: 'BASSA', alerts: alerts };
                }
            }
            
            // IDH MUTATO
            if (idhStatus.includes('mutato')) {
                scores.astrocytoma += 50;
                scores.oligodendroglioma += 40;
                alerts.push({type: 'success', msg: '‚úì IDH mutato confermato'});
                
                // GRADING per IDH-mutato: mitosi + atipia + architettura + TP53
                let hasNecroMicro = data.histFeatures.necrosis && data.histFeatures.microvascular;
                let atypiaScore = 0;
                
                if (data.atypia === 'scarse') atypiaScore = 1;
                else if (data.atypia === 'moderate') atypiaScore = 2;
                else if (data.atypia === 'numerose') atypiaScore = 3;
                
                // CHECK TP53 ALTERATO (IHC >10% O NGS mutato)
                let tp53Altered = (data.p53 > 10) || (data['tp53-ngs'] === 'mutato');
                
                if (tp53Altered) {
                    alerts.push({type: 'warning', msg: 'üö® TP53 alterato (IHC>10% O NGS mutato): marker di aggressivit√† - Grade 3 minimo'});
                    scores.glioblastoma += 50;
                }
                
                // Grading logic con TP53:
                if (hasNecroMicro || data.mitosis >= 10) {
                    diagnosis.grade = 'WHO Grade 4';
                    scores.glioblastoma += 80;
                    alerts.push({type: 'warning', msg: '‚ö† Necrosi + proliferazione microvascolare/alto numero mitosi: Grade 4'});
                } else if (tp53Altered && data.mitosis >= 4) {
                    // TP53 alterato + mitosi elevate = Grade 3-4 border
                    diagnosis.grade = 'WHO Grade 3';
                    scores.glioblastoma += 60;
                    scores.astrocytoma += 40;
                    alerts.push({type: 'warning', msg: '‚ö† TP53 alterato + mitosi elevate: Grade 3 (considerare Grade 4)'});
                } else if (tp53Altered) {
                    // TP53 alterato anche senza molte mitosi = Grade 3
                    diagnosis.grade = 'WHO Grade 3';
                    scores.astrocytoma += 50;
                    alerts.push({type: 'success', msg: '‚úì TP53 alterato: Grade 3 (aggressivit√† intrinseca)'});
                } else if (atypiaScore === 3 && data.mitosis >= 4) {
                    diagnosis.grade = 'WHO Grade 3';
                    scores.astrocytoma += 40;
                    alerts.push({type: 'success', msg: '‚úì Atipia numerose + mitosi elevate: Grade 3'});
                } else if (data.mitosis >= 4 || atypiaScore >= 2) {
                    diagnosis.grade = 'WHO Grade 3';
                    scores.astrocytoma += 30;
                    alerts.push({type: 'success', msg: '‚úì Mitosi e/o atipia moderata-numerosa: Grade 3'});
                } else {
                    diagnosis.grade = 'WHO Grade 2';
                    scores.astrocytoma += 20;
                    alerts.push({type: 'success', msg: '‚úì Morfologia di basso grado (TP53 wild-type): Grade 2'});
                }
                
                // Differenziare astro vs oligo
                if (data.atrx === 'lost') {
                    diagnosis.entity = 'Astrocytoma, IDH-mutated';
                    scores.astrocytoma += 60;
                    if (tp53Altered) {
                        diagnosis.entity = 'Astrocytoma, IDH-mutated, TP53-altered';
                        scores.astrocytoma += 30;
                    }
                    alerts.push({type: 'success', msg: '‚úì ATRX loss ‚Üí Astrocytoma favorito'});
                } else if (data.atrx === 'retained' && data.olig2 === 'positive') {
                    diagnosis.entity = 'Oligodendroglioma, IDH-mutated and 1p/19q-codeleted';
                    scores.oligodendroglioma += 80;
                    if (data['1p19q'] === 'codeleted') {
                        alerts.push({type: 'success', msg: '‚úì 1p/19q codel confermato ‚Üí Oligodendroglioma definito'});
                        scores.oligodendroglioma += 50;
                    }
                }
            }
            
            // IDH WILDTYPE
            if (idhStatus === 'wildtype' || idhStatus === 'wildtype-ihc') {
                alerts.push({type: 'success', msg: '‚úì IDH wildtype confermato'});
                
                // GRADING per IDH-wildtype
                if (data.mitosis >= 10 || (data.histFeatures.necrosis && data.histFeatures.microvascular)) {
                    diagnosis.grade = 'WHO Grade 4';
                    diagnosis.entity = 'Glioblastoma, IDH-wildtype';
                    scores.glioblastoma += 100;
                    alerts.push({type: 'success', msg: '‚úì Grade 4 (GBM) confermato'});
                } else {
                    diagnosis.grade = 'WHO Grade 2-3';
                    diagnosis.entity = 'Glioma diffuso, IDH-wildtype (tipo da determinare)';
                    scores.glioblastoma += 40;
                }
                
                // Fattori molecolari addizionali
                if (data.tert === 'mutato') {
                    scores.glioblastoma += 30;
                    alerts.push({type: 'success', msg: '‚úì TERT promoter mutato ‚Üí favorisce GBM'});
                }
                if (data.egfr === 'amplified') {
                    scores.glioblastoma += 40;
                    alerts.push({type: 'success', msg: '‚úì EGFR amplificato ‚Üí favorisce GBM primario'});
                }
            }
            
            // CALCOLO CONFIDENZA %
            let totalScore = Math.max(scores.astrocytoma, scores.oligodendroglioma, scores.glioblastoma, scores.dmg);
            let confidence = {
                astrocytoma: totalScore > 0 ? Math.round((scores.astrocytoma / totalScore) * 100) : 0,
                oligodendroglioma: totalScore > 0 ? Math.round((scores.oligodendroglioma / totalScore) * 100) : 0,
                glioblastoma: totalScore > 0 ? Math.round((scores.glioblastoma / totalScore) * 100) : 0,
                dmg: totalScore > 0 ? Math.round((scores.dmg / totalScore) * 100) : 0
            };
            
            diagnosis.confidence = confidence;
            diagnosis.alerts = alerts;
            
            // Predittivi MGMT
            if (diagnosis.grade === 'WHO Grade 4' && data.mgmt) {
                if (data.mgmt === 'methylated') {
                    alerts.push({type: 'success', msg: '‚úì MGMT metilato: predittore favorevole per temozolomide'});
                } else if (data.mgmt === 'unmethylated') {
                    alerts.push({type: 'warning', msg: '‚ö† MGMT non metilato: predittore sfavorevole, considerare alternative a TMZ'});
                }
            }
            
            return diagnosis;
        }
        
        function displayDiagnosis(diagnosis, data) {
            let html = '';
            
            // ALERTS
            if (diagnosis.alerts) {
                for (let alert of diagnosis.alerts) {
                    const cls = alert.type === 'warning' ? 'alert-warning' : (alert.type === 'success' ? 'alert-success' : 'alert-info');
                    html += '<div class="alert ' + cls + '">' + alert.msg + '</div>';
                }
            }
            
            // DIAGNOSI
            if (diagnosis.entity) {
                html += '<div class="diagnosis-box">';
                html += '<h3>Diagnosi Finale WHO CNS5</h3>';
                html += '<div class="diagnosis-text"><strong>Entit√†:</strong> ' + diagnosis.entity + '</div>';
                html += '<div class="diagnosis-text"><strong>Grado:</strong> ' + diagnosis.grade + '</div>';
                html += '</div>';
            }
            
            // SCORING CON CONFIDENCE BARS
            if (diagnosis.confidence) {
                html += '<div class="scoring-container">';
                html += '<h3 style="margin-bottom: 20px; font-size: 16px;">üìä Analisi Scoring Diagnostico</h3>';
                
                const conf = diagnosis.confidence;
                const entities = [
                    { name: 'Astrocytoma, IDH-mutated', percent: conf.astrocytoma, color: '#3b82f6' },
                    { name: 'Oligodendroglioma, IDH-mut 1p/19q-codel', percent: conf.oligodendroglioma, color: '#8b5cf6' },
                    { name: 'Glioblastoma, IDH-wildtype', percent: conf.glioblastoma, color: '#ef4444' },
                    { name: 'Diffuse Midline Glioma, H3K27-altered', percent: conf.dmg, color: '#f59e0b' }
                ];
                
                for (let entity of entities) {
                    if (entity.percent > 0) {
                        html += '<div class="scoring-row">';
                        html += '<div class="scoring-label">';
                        html += '<span class="scoring-label-name">' + entity.name + '</span>';
                        html += '<span class="scoring-label-percent">' + entity.percent + '%</span>';
                        html += '</div>';
                        html += '<div style="width: 100%; height: 30px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">';
                        html += '<div style="width: ' + entity.percent + '%; height: 100%; background: ' + entity.color + '; transition: width 0.3s ease;"></div>';
                        html += '</div>';
                        html += '</div>';
                    }
                }
                
                html += '</div>';
            }
            
            // RIEPILOGO
            html += '<div class="diagnosis-box" style="margin-top: 20px;">';
            html += '<h3>Riepilogo Findings</h3>';
            html += '<table style="width:100%; font-size: 12px; border-collapse: collapse;">';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600; width: 50%;">Et√† / Sede</td><td>' + data.age + 'a. / ' + data.location + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">Cellularit√† / Atipia</td><td>' + data.cellularity + ' / ' + data.atypia + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">Mitosi / Ki-67</td><td>' + data.mitosis + ' / ' + data.ki67 + '%</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">IDH (IHC/NGS)</td><td>' + data['idh-ihc'] + ' / ' + data['idh-ngs'] + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">ATRX / OLIG2</td><td>' + data.atrx + ' / ' + data.olig2 + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">1p/19q / TERT</td><td>' + data['1p19q'] + ' / ' + data.tert + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">H3K27me3 / H3F3A</td><td>' + data.h3k27me3 + ' / ' + data.h3f3a + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">p53 IHC / TP53 NGS</td><td>' + data.p53 + '% / ' + data['tp53-ngs'] + '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px; font-weight: 600;">CDKN2A/B</td><td>' + data.cdkn2a + '</td></tr>';
            html += '<tr style="background: #fef3c7;"><td style="padding: 8px; font-weight: 600;">MGMT / O6-MG</td><td>' + (data.mgmt || 'N/A') + ' / ' + (data.o6mg || 'N/A') + '</td></tr>';
            html += '</table>';
            html += '</div>';
            
            document.getElementById('report-container').innerHTML = html;
        }
        
        function exportPDF() {
            const reportElement = document.getElementById('report-container');
            
            if (!reportElement || reportElement.innerHTML.trim() === '') {
                alert('Genera prima una diagnosi per esportare il PDF');
                return;
            }
            
            const opt = {
                margin: 10,
                filename: 'Report_Glioma_' + new Date().toISOString().split('T')[0] + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            const pdfContent = document.createElement('div');
            pdfContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2>REPORT DIAGNOSTICO GLIOMI SNC - v2.1</h2>
                    <p>Data: ${new Date().toLocaleDateString('it-IT')}</p>
                    <p style="font-size: 12px; color: #666;">Workflow WHO CNS5 2021 con Scoring Avanzato & Bibliografia Interattiva</p>
                </div>
                <hr>
                ${reportElement.innerHTML}
            `;
            
            html2pdf().set(opt).from(pdfContent).save();
        }
    </script>
</body>
</html>
